<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>UFO Sightings by Country (Absolute)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
  <style>
    body{margin:0;font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    #vis{max-width:1100px;margin:32px auto;padding:0 16px}
    footer{max-width:1100px;margin:0 auto 28px;padding:0 16px;font-size:12px;color:#475569}
  </style>
</head>
<body>
<div id="vis"></div>
<footer>
  Data: UFO sighting reports (compiled); Map: Natural Earth. Absolute counts shown (consider per-million in report).
</footer>

<script>
const spec = {
  $schema: "https://vega.github.io/schema/vega-lite/v5.json",
  width: 980,
  height: 560,
  title: {text: "UFO Sightings by Country (Absolute Counts)", anchor: "start"},
  projection: {type: "robinson"},

  // ðŸ”¹ Use your GeoJSON file (exact filename)
  data: {url: "ne_110m_admin_0_countries.json", format: {type: "geojson"}},

  // ðŸ”¹ Prepare join key (try ISO_A2 first, then ISO_A2_EH; uppercase for matching)
  transform: [
    { calculate: "toUpper(datum.properties.ISO_A2 || datum.properties.ISO_A2_EH || '')", as: "ISO_A2_UP" },

    // Join to your CSV: ufo_country_counts_joinready.csv (key: country_upper)
    {
      lookup: "ISO_A2_UP",
      from: {
        data: { url: "ufo_country_counts_joinready.csv" },
        key: "country_upper",
        fields: ["sightings"]
      }
    },

    // Replace missing sightings with 0 so legend/scales behave
    { calculate: "isValid(datum.sightings) ? datum.sightings : 0", as: "sightings_filled" }
  ],

  layer: [
    // Graticule
    {
      data: { graticule: { step: [20, 20] } },
      mark: { type: "geoshape", filled: false, stroke: "#d7d7d7", strokeWidth: 0.5 }
    },

    // Choropleth
    {
      mark: { type: "geoshape" },
      encoding: {
        color: {
          field: "sightings_filled", type: "quantitative",
          scale: { scheme: "blues" },
          legend: { title: "Sightings" }
        },
        tooltip: [
          { field: "properties.NAME", title: "Country" },
          { field: "ISO_A2_UP", title: "ISO A2" },
          { field: "sightings_filled", title: "Sightings" }
        ]
      }
    },

    // Borders on top
    {
      mark: { type: "geoshape", filled: false, stroke: "#8e97a3", strokeWidth: 0.7 }
    }
  ]
};

vegaEmbed("#vis", spec, { actions: false });
</script>
</body>
</html>
